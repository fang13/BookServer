# 数据库设计说明

数据库表中应包含：
用户列表 Uer_table
图书列表 Books_table (指的是所有图书列表)
图书馆列表 Library_table
管理员列表 Admin_table
图书分类列表 BookClass_table(应该是图书中类别的外键)

# 数据库操作说明
##  使用命令创建数据说明

切换到数据库bookLib
```sql
use bookLib
```

## 创建数据表
### 1.创建**图书**数据表
```sql
CREATE TABLE IF NOT EXISTS books_table(
   bookID VARCHAR(40) NOT NULL,
   PrimaryClass  VARCHAR(40) NOT NULL,
   secondaryClass VARCHAR(40) NOT NULL,
   bookName VARCHAR(40) NOT NULL,
   ISBN10 VARCHAR(20) NOT NULL,
   ISBN13 VARCHAR(20) NOT NULL,
   page INT UNSIGNED NOT NULL,
   author VARCHAR(40) NOT NULL,
   publisher VARCHAR(40) NOT NULL,
   publishDate DATA NOT NULL,
   amount INT UNSIGNED NOT NULL,
   descption VARCHAR(200) NOT NULL,
   borrowedTimes INT UNSIGNED NOT NULL,
   collectionTimes INT UNSIGNED NOT NULL,
   label VARCHAR(40) NOT NULL,
   currentLocation VARCHAR(30) NOT NULL,
   homeLocation VARCHAR(30) NOT NULL,
   isCanBeBorrowed VARCHAR(40) NOT NULL,
   state VARCHAR(40) NOT NULL,
   joinTime  DATETIME NOT NULL,
   PRIMARY KEY ( id, ISBN, name, author )
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```
bookID可以用常量+自增来设计
location 存放的应该是图书馆的名称，外键形式
一级分类和二级分类应该是外键

## 插入数据
### 向数据库中插入**书籍**数据
```sql
INSERT INTO books 
     (id, levelOne, levelTwo, name, ISBN, author, publisher, publishDate, amount, borrowedTimes, label, descption, storeInfo, collectionTimes, isCanBeBorrowed, state, borrowHistory )
     VALUES
     ("123", "测试", "插入书籍测试","围城", "123456", "钱钟书", "出版者", "出版时间",10, 20, "标签", "描述", "存储信息", 10, "true", "在管", "借阅历史");
```

### 2.创建**用户**数据表
```sql
CREATE TABLE IF NOT EXISTS user_table(
   userID VARCHAR(10) NOT NULL,
   profilePicture VARCHAR(40) NOT NULL,
   userName VARCHAR(40) NOT NULL,
   nickName VARCHAR(40) NOT NULL,
   jobID VARCHAR(40) NOT NULL,
   phoneNumber VARCHAR(40) NOT NULL,
   joinTime VARCHAR(40) NOT NULL,
   state VARCHAR(40) NOT NULL,
   authority VARCHAR(40) NOT NULL,
   PRIMARY KEY ( id, jobID, name, state,nickName)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

### 向数据库中插入**用户**信息
```sql
INSERT INTO user 
     (id,pitcture,name,nickName,jobID,phoneNumber,joinTime,state,authority)
     VALUES
     ("12345","头像","周","zhou","z5002223","13100001111","2019-3-6","normal","user");
```

### 3.创建**图书馆列表**数据表
```sql
CREATE TABLE IF NOT EXISTS library_table(
   libraryID INT UNSIGNED NOT NULL AUTO_INCREMENT,
   libraryName VARCHAR(40) NOT NULL,
   owner VARCHAR(40) NOT NULL,
   joinTime DATETIME NOT NULL,
   location VARCHAR(200) NOT NULL,
   description VARCHAR(200) NOT NULL,
   PRIMARY KEY (libraryID),
   UNIQUE KEY (libraryName),
   INDEX (libraryName)
)ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=300;
```


### 向数据库中插入**图书馆**信息
```sql
INSERT INTO library_table 
     (libraryName,owner,joinTime,location,description)
     VALUES
     ("abc图书馆","abc","2019-7-27 23:56:00","广东省xx市","这是一个很好的图书馆");
```

### 4.创建**借阅记录**数据表
```sql
CREATE TABLE IF NOT EXISTS borrowHistory_table(
   borrowHistoryID INT UNSIGNED NOT NULL AUTO_INCREMENT,
   userID INT UNSIGNED NOT NULL ,
   userName VARCHAR(40) NOT NULL,
   bookID INT UNSIGNED NOT NULL,
   bookName VARCHAR(40) NOT NULL,
   startBorrowTime DATETIME NOT NULL,
   returnTime DATETIME,
   borrowLibraryName VARCHAR(40) NOT NULL,
   returnLibraryName VARCHAR(40) NOT NULL,
   isReturned CHAR(1) NOT NULL,
   isOutOfDate CHAR(1) NOT NULL,
   PRIMARY KEY (borrowHistoryID),
   INDEX (userID, bookID, bookName,startBorrowTime, returnTime, isReturned, isOutOfDate),
)ENGINE=InnoDB DEFAULT CHARSET=utf8  AUTO_INCREMENT=400;
```
isOutOfDate 是否超时
isReturned 是否归还了

定义借阅图书馆和归还图书馆为图书馆列表中名称的外键
alter table borrowHistory_table add constraint FK_ID foreign key libraryName references library_table borrowLibrary
alter table borrowHistory_table add constraint FK_ID foreign key libraryName references library_table returnLibrary

[on delete {cascade | set null | no action| restrict}]
[on update {cascade | set null | no action| restrict}]

### 5.创建**分类列表**数据表
```sql
CREATE TABLE IF NOT EXISTS bookClass_table(
   classID INT UNSIGNED NOT NULL  AUTO_INCREMENT,
   className VARCHAR(40) NOT NULL ,
   isPrimaryClass CHAR(1) NOT NULL,
   issecondaryClass CHAR(1) NOT NULL ,
   INDEX (classID,className,isPrimaryClass,issecondaryClass ),
   PRIMARY KEY (classID, className),
   UNIQUE KEY (className)
)ENGINE=InnoDB DEFAULT CHARSET=UTF8, AUTO_INCREMENT=500;
```
插入分类列表数据
```sql
INSERT INTO bookClass_table 
     (className,isPrimaryClass,issecondaryClass)
     VALUES
     ("古代文学",1,0);
```
### 6.创建**管理员列表**数据表
```sql
CREATE TABLE IF NOT EXISTS Admin_table(
   adminID INT UNSIGNED NOT NULL  AUTO_INCREMENT,
   adminName VARCHAR(40) NOT NULL ,
   password VARCHAR(40) NOT NULL,
   INDEX (adminName),
   PRIMARY KEY (adminID ),
   UNIQUE KEY (adminName)
)ENGINE=InnoDB DEFAULT CHARSET=UTF8, AUTO_INCREMENT=600;
```

### 7.创建**标签列表**数据表(待定)
```sql
CREATE TABLE IF NOT EXISTS labels_table(
   labelID INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
   labelName VARCHAR(40) NOT NULL,
   PRIMARY KEY (labelID)
   INDEX (labelName)
)ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=600;
```



注意加入时间


## 查询数据
示例：从表books中查询id和书名
```sql
SELECT id,name
FROM books
```