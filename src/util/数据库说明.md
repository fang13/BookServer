# 数据库设计说明

数据库表中应包含：
用户列表 Uer_table
图书列表 Books_table (指的是所有图书列表)
图书馆列表 Library_table
管理员列表 Admin_table
图书分类列表 BookClass_table(应该是图书中类别的外键)

# 数据库操作说明
##  使用命令创建数据说明

切换到数据库bookLib
```sql
use bookLib
```

## 创建数据表
### 1.创建**图书**数据表
```sql
CREATE TABLE IF NOT EXISTS books_table(
   bookID INT UNSIGNED NOT NULL,
   PrimaryClass  VARCHAR(40) NOT NULL,
   secondaryClass VARCHAR(40) NOT NULL,
   bookName VARCHAR(40) NOT NULL,
   ISBN10 VARCHAR(20) ,
   ISBN13 VARCHAR(20) ,
   author VARCHAR(40) NOT NULL,
   publisher VARCHAR(40) NOT NULL,
   publishDate DATE NOT NULL,
   descption VARCHAR(200) NOT NULL,
   borrowedTimes INT UNSIGNED NOT NULL,
   collectionTimes INT UNSIGNED NOT NULL,
   label VARCHAR(40) NOT NULL,
   currentLibrary VARCHAR(30) NOT NULL,
   homeLibrary VARCHAR(30) NOT NULL,
   isCanBeBorrowed CHAR(1) NOT NULL,
   state VARCHAR(40) NOT NULL,
   joinTime  DATETIME NOT NULL,
   PRIMARY KEY ( bookID ),
   INDEX (PrimaryClass, secondaryClass,bookName,author,borrowedTimes,collectionTimes,label,currentLibrary,homeLibrary,isCanBeBorrowed,state),
   FOREIGN KEY(currentLibrary) REFERENCES library_table(libraryName) ON DELETE restrict ON UPDATE CASCADE,
   FOREIGN KEY(homeLibrary) REFERENCES library_table(libraryName) ON DELETE restrict ON UPDATE CASCADE,
   FOREIGN KEY(PrimaryClass) REFERENCES bookClass_table(className) ON DELETE restrict ON UPDATE CASCADE,
   FOREIGN KEY(secondaryClass) REFERENCES bookClass_table(className) ON DELETE restrict ON UPDATE CASCADE
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```
bookID可以用常量+自增来设计
location 存放的应该是图书馆的名称，外键形式
一级分类和二级分类应该是外键
### 向数据库中插入**书籍**数据
```sql
INSERT INTO books_table 
     (bookID, PrimaryClass, secondaryClass, bookName, ISBN10, ISBN13, author, publisher, publishDate, descption, borrowedTimes, collectionTimes, label, currentLibrary, homeLibrary, isCanBeBorrowed, state, joinTime )
     VALUES
     ("101", "古代文学", "诗词歌赋","围城", "123456",'', "钱钟书", "出版者", "2012-6-2",'一本好看的书',10, 20, "热门收藏", "abc图书馆","abc图书馆", 1,  "在馆", "2019-8-30 9:30:20");
```


### 2.创建**用户**数据表
```sql
CREATE TABLE IF NOT EXISTS user_table(
   userID  INT UNSIGNED NOT NULL,
   profilePicture VARCHAR(40) NOT NULL,
   userName VARCHAR(40) NOT NULL,
   nickName VARCHAR(40) NOT NULL,
   jobID VARCHAR(40) NOT NULL,
   phoneNumber VARCHAR(40) NOT NULL,
   joinTime DATETIME NOT NULL,
   state VARCHAR(40) NOT NULL,
   authority VARCHAR(40) NOT NULL,
   PRIMARY KEY (userID),
   UNIQUE KEY (nickName),
   INDEX (nickName, authority,state,jobID,phoneNumber)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

### 向数据库中插入**用户**信息
```sql
INSERT INTO user_table 
     (userID,profilePicture,userName,nickName,jobID,phoneNumber,joinTime,state,authority)
     VALUES
     (201,"头像","周","zhou","z5002223","13100001111","2019-3-6 20:50:20","normal","user");
```

### 3.创建**图书馆列表**数据表
```sql
CREATE TABLE IF NOT EXISTS library_table(
   libraryID INT UNSIGNED NOT NULL ,
   libraryName VARCHAR(40) NOT NULL,
   owner VARCHAR(40) NOT NULL,
   joinTime DATETIME NOT NULL,
   location VARCHAR(200) NOT NULL,
   description VARCHAR(200) NOT NULL,
   PRIMARY KEY (libraryID),
   UNIQUE KEY (libraryName),
   INDEX (libraryName)
)ENGINE=InnoDB DEFAULT CHARSET=utf8 ;
```


### 向数据库中插入**图书馆**信息
```sql
INSERT INTO library_table 
     (libraryID, libraryName,owner,joinTime,location,description)
     VALUES
     (301,"abc图书馆","abc","2019-7-27 23:56:00","广东省xx市","这是一个很好的图书馆");
```

### 4.创建**借阅记录**数据表
```sql
CREATE TABLE IF NOT EXISTS borrowHistory_table(
   borrowHistoryID INT UNSIGNED NOT NULL,
   userID INT UNSIGNED NOT NULL ,
   userName VARCHAR(40) NOT NULL,
   bookID INT UNSIGNED NOT NULL,
   bookName VARCHAR(40) NOT NULL,
   startBorrowTime DATETIME NOT NULL,
   returnTime DATETIME,
   borrowLibraryName VARCHAR(40) NOT NULL,
   returnLibraryName VARCHAR(40) NOT NULL,
   isReturned CHAR(1) NOT NULL,
   isOutOfDate CHAR(1) NOT NULL,
   PRIMARY KEY (borrowHistoryID),
   INDEX (userID, bookID, bookName,startBorrowTime, returnTime, isReturned, isOutOfDate),
   FOREIGN KEY(borrowLibraryName) REFERENCES library_table(libraryName) ON DELETE restrict ON UPDATE CASCADE,
   FOREIGN KEY(returnLibraryName) REFERENCES library_table(libraryName) ON DELETE restrict ON UPDATE CASCADE
)ENGINE=InnoDB DEFAULT CHARSET=utf8  ;
```
注意重新定义借阅记录，需要将bookID和userID定义外外键。可删除，不可更新。
isOutOfDate 是否超时
isReturned 是否归还了

定义借阅图书馆和归还图书馆为图书馆列表中名称的外键
插入一条借阅记录数据
```sql
INSERT INTO borrowHistory_table 
     (borrowHistoryID,userID,userName,bookID, bookName, startBorrowTime, returnTime, borrowLibraryName, returnLibraryName, isReturned, isOutOfDate)
     VALUES
     (401,"12345","小明",102,"围城","2019-7-27 23:56:00","2019-7-28 9:35:00","abc图书馆","abc图书馆",1,0);
```

### 5.创建**分类列表**数据表
```sql
CREATE TABLE IF NOT EXISTS bookClass_table(
   classID INT UNSIGNED NOT NULL ,
   parentID INT UNSIGNED,
   className VARCHAR(40) NOT NULL ,
   isPrimaryClass CHAR(1) NOT NULL,
   issecondaryClass CHAR(1) NOT NULL,
   INDEX (classID,parentID,className,isPrimaryClass,issecondaryClass ),
   PRIMARY KEY (classID),
   UNIQUE KEY (className)
)ENGINE=InnoDB DEFAULT CHARSET=UTF8;
```
插入分类列表数据
```sql
INSERT INTO bookClass_table 
     (classID,className,isPrimaryClass,issecondaryClass)
     VALUES
     (501,"古代文学",1,0);
```
### 6.创建**管理员列表**数据表
```sql
CREATE TABLE IF NOT EXISTS Admin_table(
   adminID INT UNSIGNED NOT NULL,
   adminName VARCHAR(40) NOT NULL ,
   password VARCHAR(40) NOT NULL,
   INDEX (adminName),
   PRIMARY KEY (adminID ),
   UNIQUE KEY (adminName)
)ENGINE=InnoDB DEFAULT CHARSET=UTF8;
```

### 7.创建**标签列表**数据表
```sql
CREATE TABLE IF NOT EXISTS labels_table(
   labelID INT UNSIGNED NOT NULL,
   labelName VARCHAR(40) NOT NULL,
   PRIMARY KEY (labelID),
   INDEX (labelName)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```
插入标签
```sql
INSERT INTO labels_table 
     (labelID,labelName)
     VALUES
     (701,"热门收藏");
```


注意加入时间


## 查询数据
示例：从表books中查询id和书名
```sql
SELECT id,name
FROM books
```
查询到重复数据时返回ID最小的数据.
```sql
Select * From books_table Where bookID In (Select MIN(bookID) From books_table Group By bookName)
```
